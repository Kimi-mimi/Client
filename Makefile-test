C_VER := -std=c99
FLAGS := -Wall -Werror -pedantic
CUNIT := -lcunit
BUILD_ROOT_DIR := build
BUILD_DIR := $(BUILD_ROOT_DIR)/test

all: test

create_build_dir:
	mkdir -p $(BUILD_DIR)

test: create_build_dir test.o string_test.o bytes_test.o bytes.o string.o
	gcc $(C_VER) $(FLAGS) $(CUNIT) -o $(BUILD_DIR)/test \
$(BUILD_DIR)/test.o \
$(BUILD_DIR)/string_test.o \
$(BUILD_DIR)/bytes_test.o \
$(BUILD_ROOT_DIR)/string.o \
$(BUILD_ROOT_DIR)/bytes.o

test.o: test.c bytes/test/string_test.h
	gcc $(C_VER) $(FLAGS) -c test.c -o $(BUILD_DIR)/test.o

string_test.o: bytes/test/string_test.c bytes/test/string_test.h bytes/string.h
	gcc $(C_VER) $(FLAGS) -c bytes/test/string_test.c -o $(BUILD_DIR)/string_test.o

bytes_test.o: bytes/test/bytes_test.c bytes/test/bytes_test.h bytes/bytes.h
	gcc $(C_VER) $(FLAGS) -c bytes/test/bytes_test.c -o $(BUILD_DIR)/bytes_test.o

string.o: bytes/string.h bytes/string.c errors/client_errors.h bytes/bytes.h
	gcc $(C_VER) $(FLAGS) -c bytes/string.c -o $(BUILD_ROOT_DIR)/string.o

bytes.o: bytes/bytes.h bytes/bytes.c errors/client_errors.h
	gcc $(C_VER) $(FLAGS) -c bytes/bytes.c -o $(BUILD_ROOT_DIR)/bytes.o

clean:
	rm -rf $(BUILD_DIR)